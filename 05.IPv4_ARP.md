Mặc dù MAC là một địa chỉ phần cứng độc lập nhưng vẫn cần sử dụng để vận chuyển dữ liệu qua link layer ( Một số ngoại lệ như point-to-point hay danh tính của nơi nhận bị ẩn ) . 

IPv4 sử dụng **ARP** ( Address Resolution Protocol ), giao thức này có thể được sử dụng trên bất kỳ loại mạng nhưng phổ biến nhất vẫn là Ethernet

Nếu host A muốn gửi packet đến host B trên cùng một Ethernet, nó sử dụng ARP để kiểm tra phần cứng của host B. Nếu host B không nằm trên cùng một network với A, host A sẽ sử dụng bảng định tuyến để xác định next-hop và tuyến đường đến B sau đó sử dụng ARP để kiểm tra địa chỉ phần cứng. Giao thức này chỉ có thể được sử dụng để tìm các địa chỉ phần cứng của máy được kết nối trực tiếp đến mạng local của máy gửi

Mỗi thiết bị duy trì một bảng trong bộ nhớ gọi là ARP cache, nơi chứa kết quả truy vấn gần nhất. Trong một số trường hợp, có nhiều địa chỉ cần được kiểm tra sớm sau quá trình boot. ARP cache không chiếm nhiều lưu lượng mạng

ARP hoạt động bằng broadcast hoặc multicast, packet sẽ gửi đi" Does anyone know
the hardware address for IP address X? ". Máy được tìm kiếm phát hiện ra IP của mình và phản hồi : "Yes, that’s the IP address assigned to one of my network interfaces, and thecorresponding MAC address is 08:00:20:00:fb:6a.”

Có 4 loại địa chỉ trong một bản tin ARP:

- Sender Hardware Address ( SHA ): Địa chỉ MAC của người gửi
  - Trong bản tin ARP request: trường này xác định địa chỉ MAC của host gửi request.
  - Trong bản tin ARP reply: trường này xác định địa chỉ MAC của máy host mà máy gửi bên trên muốn tìm kiếm
- Sender Protocol Address ( SPA ): Địa chỉ IP của người gửi
- Target Hardware Address ( THA ): Địa chỉ MAC của người nhận
  - Trong bản tin ARP request: Trường này chưa được xác định (nên sẽ để giá trị là: 00:00:00:00:00:00)
  - Trong bản tin ARP reply: Trường này sẽ điền địa chỉ của máy gửi bản tin ARP request.
- Target Protocol Address ( TPA ): Địa chỉ IP của người gửi

<img src="https://github.com/vjnkvt/Images/blob/master/base-arp.png">

Bước 1 : Máy gửi kiểm tra cache của mình. Nếu đã có thông tin về sự ánh xạ giữa địa chỉ IP và địa chỉ MAC thì chuyển sang

Bước 2 : Máy gửi khởi tạo gói tin ARP request với các địa chỉ SHA, SPA, THA, TPA

Bước 3 : Máy gửi quảng bá gói tin ARP Request trên toàn mạng ( địa chỉ MAC đích là địa chỉ MAC quảng bá ff:ff:ff:ff:ff:ff )

Bước 4 : Các thiết bị trong mạng đều nhận được gói tin ARP Request. Gói tin được xử lý bằng cách các thiết bị đều nhìn vào trường địa chỉ TPA. Nếu trùng với địa chỉ của mình thì tiếp tục xử lý, nếu không thì hủy gói tin

Bước 5 : Thiết bị với IP trùng với IP trong trường TPA sẽ bắt đầu quá trình khởi tạo gói tin ARP Reply bằng cách lấy các trường SHA và SPA trong gói tin ARP nhận được đưa vào làm Target trong gói tin gửi đi. Đồng thời thiết bị sẽ lấy địa chỉ MAC của mình để đưa vào trường SHA, và cập nhật bảng ánh xạ địa chỉ IP và MAC của máy gửi vào bảng ARP cache của mình để giảm bớt thời gian xử lý cho các lần sau

Bước 6 : Máy gửi nhận được gói tin reply và xử lý bằng cách lưu trường SHA trong gói reply như địa chỉ phần cứng của máy nhận

Bước 7 : Máy gửi update vào ARP cache của mình giá trị tương ứng giữa địa chỉ IP và địa chỉ MAC của máy nhận. Lần sau sẽ không còn cần tới ARP request
